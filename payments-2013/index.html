<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Payments in the Marketplace</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/one-mozilla.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

    <link rel="stylesheet" href="lib/css/override.css">
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

        <section>
        <h2>Payments in <br>the Firefox Marketplace</h2>
          <p>
            <small>
              <a href="http://www.agmweb.ca/blog/andy">Andy McKay</a><br>
              <a href="http://twitter.com/andymckay">@andymckay</a><br>
              <a href="https://github.com/andymckay/presentations">github.com/andymckay/presentations</a>
            </small>
          </p>
        </section>

        <section>
          <h3>Firefox Marketplace</h3>
          <p>App installed on all Firefox OS phones</p>
          <p>
          <img src="img/marketplace.png" />
        </section>

        <section>
          <h3>Payments</h3>
          <p>Allow developers to get paid for their apps</p>
          <div class="fragment">
            <p>There is <b>no lock in</b></h3>
            <p>You are <b>free</b> to do payments any way you choose</p>
            <p>You can <i>optionally</i> list apps in the Marketplace and <i>optionally</i> use our payments system</p>
          </div>
          <p class="fragment">Current revenue share varies (<a href="https://developer.mozilla.org/en-US/docs/Web/Apps/Publishing/App_pricing">please see docs</a>)</p>
        </section>

        <section>
          <h3>In action</h3>
          <p><b>INSERT VIDEO HERE</b></p>
        </section>

        <section>
          <h3>Payment methods</h3>
          <p>Operator payment: amount appears on your phone bill</p>
          <p>Credit card payment</p>
        </section>

        <section>
          <h3>Countries</h3>
          <p>Rolling out per country as the phones launch</p>
          <p>Currently working in: <b>Colombia, Poland, Spain</b></p>
          <p class="fragment">In testing in: <b>UK, US, Venezuela</b></p>
          <p class="fragment">Check our <a href="https://marketplace.firefox.com/developers/docs/payments/status">status page</a></p>
        </section>

        <section>
          <h3>How to setup payments</h3>
          <ol>
            <li>Make an awesome app</li>
            <li>Register your app on the Marketplace</li>
            <li>To accept payments your app will have to be Firefox OS compatible, only</li>
          </ol>
        </section>

        <section>
          <h3>Create a payment account</h3>
          <p>So the payment provider (currently Bango) can pay you</p>
          <img src="img/add-account.png" />
        </section>

        <section>
          <h3>Price points</h3>
          <p>A price point represents one price across regions, currencies and carriers</p>
          <img src="img/tiers.png" />
          <p>Read the <a href="https://developer.mozilla.org/en-US/docs/Web/Apps/Publishing/App_pricing">docs on pricing</a></p>
        </section>

        <section>
          <h3>Price point</h3>
          <p>Paid apps must choose one</p>
          <p>In-app payments can use any price points</p>
          <img src="img/in-app-choices.png" />
        </section>

        <section>
          <h3>But...</h3>
          <p>Before you publish, you will need to do a bit of work in your app.</p>
        </section>

        <section>
          <h3>For paid apps</h3>
          <p>After the payment is processed, a receipt is installed</p>
          <p>Read the <a href="https://wiki.mozilla.org/Apps/WebApplicationReceipt">docs on receipts</a></p>
          <p class="fragment">It is the <b>app developers</b> job to check receipts</p>
          <p class="fragment">If you <b>do not</b> check receipts, your app can be used for free</p>
        </section>

        <section>
          <h3>Receipt verification</h3>
          <ol>
            <li>Check crypto</li>
            <li>Check contents
              <ul>
                <li>its from a store you approve of</li>
                <li>its for your app</li>
                <li>its of the right type</li>
              </ul>
            </li>
            <li class="fragment">(Optionally) Verify against the marketplace</li>
            <li class="fragment">(Optionally) Verify against your own servers <sup>*</sup></li>
          </ol>
          <div class="fragment">
            <hr></hr>
            <p>Read the <a href="https://developer.mozilla.org/en-US/docs/Web/Apps/Publishing/Validating_a_receipt">docs on verification</a></p>
            <p>Use the <a href="https://github.com/mozilla/receiptverifier">library</a></p>
          </div>
        </section>

        <section>
          <h3>Receipt errors</h3>
          <p>Up to the app developer:</p>
          <ol>
            <li>When to check receipts</li>
            <li>What to do when it fails</li>
          </ol>
        </section>

        <section>
          <h3>In app payments</h3>
          <p>Payment keys to identify your app</p>
          <img src="img/in-app-keys.png" />
        </section>

        <section>
          <h3>Create a button</h3>
          <pre><code class="html">
&lt;button id="purchase"&gt;
  Purchase Magical Unicorn for $0.99
&lt;/button&gt;
          </code></pre>
          <p>There is <a href="http://firefox-marketplace-api.readthedocs.org/en/latest/topics/payment.html#localized-tier">an API</a> to help you localise using the language
        </section>

        <section>
          <h3>Start payment</h3>
          <p>Create some JSON that shows the payment in your app</p>
          <p>A truncated example:</p>
          <pre><code class="javascript">
{
  "iss": APPLICATION_KEY,
  "aud": "marketplace.firefox.com",
  "typ": "mozilla/payments/pay/v1",
  "request": {
    "id": "915c07fc-87df-46e5-9513-45cb6e504e39",
    "pricePoint": 10,
    "name": "Magical Unicorn" ...
          </code></pre>
          <p>Read the <a href="https://developer.mozilla.org/en-US/docs/Web/Apps/Publishing/In-app_payments">docs on making in-app payments</a></p>
       </section>

       <section>
          <h3>Sign the request</h3>
          <p>Sign the request with the secret,<br> there are <a href="https://github.com/progrium/pyjwt">libraries for this</a></p>
          <p>Call <code>navigator.mozPay</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/window.navigator.mozPay">docs</a>) with the signed JSON</p>
          <p>The payment flow will start</p>
          <p class="fragment">Signing should be <b>done on a server</b>, because distributing the secret in your app is not secure</p>
        </section>

        <section>
          <h3>Handling the response</h3>
          <p>We will post the response to you</p>
          <p>A truncated example:</p>
          <pre><code class="javascript">
{
  "iss": "marketplace.firefox.com",
  "aud": APPLICATION_KEY,
  "typ": "mozilla/payments/pay/postback/v1",
  ...
  "response": {
    "transactionID": "webpay:84294ec6-7352",
    "price": {"amount": "0.99", "currency": "CAD"}
  }
}
         </code></pre>
        </section>

        <section>
          <h3>Handling the response (pt. 2)</h3>
          <p>Tell us you received it</p>
          <p>It's your job to maintain a list of purchases</p>
          <pre><code class="javascript">
HTTP/1.1 200 OK
Content-Type: text/plain

webpay:84294ec6-7352
          </code></pre>
        </section>

        <section>
          <h3>Refunds and chargebacks</h3>
          <p>Similarly done through posts which you must respond to</p>
        </section>

        <section>
          <h3>Testing all this</h3>
          <p>You can make <a href="https://developer.mozilla.org/en-US/docs/Web/Apps/Publishing/In-app_payments#Simulating_payments">simulated in app payments</a></p>
          <p>You can make test receipts (you can also do this in the simulator)</p>
          <img src="img/test-receipt.png" />
        </section>

        <section>
          <h3>Once its all done...</h3>
          <p>Submit to the Marketplace review queue</p>
          <p>Reviewers will check and give feedback on your app, including payments</p>
          <p>Once its approved... profit!</p>
        </section>

        <section>
          <h3>Example apps</h3>
          <p>Paid app that checks receipts: <a href="https://github.com/kumar303/yacht/">Private yacht</a></p>
          <p>In app that does simulated payments: <a href="https://github.com/jlongster/webfighter">Webfighter</a></p>
        </section>

        <section>
          <h3>Help?</h3>
          <p>Mailing lists:
          <br><a href="https://lists.mozilla.org/listinfo/dev-webapps">dev-webapps</a>
          <br><a href="https://lists.mozilla.org/listinfo/dev-marketplace">dev-marketplace</a></p>
          <p>IRC:
          <br><a href="https://wiki.mozilla.org/IRC">#marketplace</a></p>
        </section>

				<section>
          <h2>Questions?</h2>
          <a href="http://twitter.com/andymckay">@andymckay</a><br>
          <a href="https://github.com/andymckay/presentations">github.com/andymckay/presentations</a>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>

